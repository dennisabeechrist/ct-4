<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>CTF Maze â€” All Flags</title>
<style>
@import url('https://fonts.googleapis.com/css2?family=Share+Tech+Mono&display=swap');
body {
  background: #04090f; color: #00ff99;
  font-family: 'Share Tech Mono', monospace;
  margin: 0; min-height: 100vh;
  display: flex; flex-direction: column; align-items: center;
}
h1 { margin: 1.1rem 0 .45rem 0; font-size: 2.18rem; text-shadow: 0 0 12px #00ff9970;}
#message {font-size: 1.18em; margin: .72em 0; min-height: 1.54em; color: #41fa94; text-align: center;}
#maze {
  margin: .28em 0 1.2em 0;
  display: grid;
  grid-template-columns: repeat(32, 17px);
  grid-template-rows: repeat(32, 17px);
  gap: 1.8px;
  background: #011019; border-radius: 1.1em;
  box-shadow: 0 0 20px #00ff9970, 0 0 10px #00ff9957 inset;
  outline: 1.18px solid #00ff992a;
  user-select: none; max-width: 99vw; overflow: auto;
}
.tile {
  width: 17px; height: 17px; border-radius: 4px; background: #17282d;
  display: flex; align-items: center; justify-content: center;
  font-size: .95em; font-family: inherit; position: relative;
}
.tile.wall { background: #253035; }
.tile.player { background: #0ef5ce; color: #071917; box-shadow: 0 0 7px #29fff7aa; z-index: 2; }
.tile.visited { background: #194340; }
.tile.flag { background: #93e6e1; color: #274357; font-weight: 700; box-shadow: 0 0 7px #a6ffe7cc;}
button { margin: .14em .10em; font-size: .97em; background: #003211; border: 1.2px solid #00faa7;
  color: #fff; border-radius: 5px; min-width: 2.1em; padding: .12em .5em; font-family: inherit;}
@media (max-width: 950px) {
  #maze { grid-template-columns: repeat(32, minmax(7px,1fr)); }
  .tile { width: 9px; height: 9px; font-size: .73em;}
}
</style>
</head>
<body>
<h1>CTF Maze: Pure Flag Hunt</h1>
<div id="message"></div>
<div style="font-size:1em;max-width:900px;line-height:1.22;text-align:center;color:#99ffd0">
  Use <b>Arrows</b> or <b>WASD</b> to collect <span style="font-size:1.04em;">ðŸš© flags</span>.<br>
  Thereâ€™s no "real" flagâ€”all flags are equal. Find them all!<br>
  Huge maze, tons of flags, *no traps, no teleports, no skulls, only exploration*.<br>
  <b>R = Reset (new hard maze)</b>.
</div>
<div id="maze" tabindex="0" aria-label="CTF Maze grid"></div>
<div>
  <button onclick="resetMaze()">Reset (R)</button>
</div>
<script>
const SIZE=32, WALL="#", PATH=".", NUMFLAGS=25;
const mazeDiv=document.getElementById("maze"),messageEl=document.getElementById("message");
let grid, player, flags=[], visited, win=false;

const EMOJIS = { player:"ðŸ¤–", flag:"ðŸš©" };

// Utility
function rng(n){return Math.floor(Math.random()*n);}
function shuffle(a){for(let i=a.length-1;i>0;i--){let j=rng(i+1);[a[i],a[j]]=[a[j],a[i]];}}
function resetMaze(){
  win=false; grid=[...Array(SIZE)].map(()=>Array(SIZE).fill(WALL));
  visited=[...Array(SIZE)].map(()=>Array(SIZE).fill(false));
  // DFS maze gen â€” always solvable, with many dead-ends for difficulty
  let st=[[0,0]]; grid[0][0]=PATH;
  while(st.length){
    let[x,y]=st[st.length-1],dirs=[];
    for(let[dx,dy] of [[0,2],[2,0],[-2,0],[0,-2]]){
      let nx=x+dx,ny=y+dy;
      if(nx>=0&&ny>=0&&nx<SIZE&&ny<SIZE&&grid[ny][nx]===WALL)dirs.push([nx,ny]);
    }
    if(dirs.length){
      let [nx,ny]=dirs[rng(dirs.length)];
      grid[(ny+y)/2][(nx+x)/2]=PATH; grid[ny][nx]=PATH; st.push([nx,ny]);
    } else st.pop();
  }
  // Place player and flags
  player={x:0,y:0}; visited[0][0]=true; flags=[];
  let empties=[];
  for(let y=0;y<SIZE;y++)for(let x=0;x<SIZE;x++)
    if(grid[y][x]==PATH&&(x!=0||y!=0))empties.push([x,y]);
  shuffle(empties);
  for(let i=0;i<NUMFLAGS;i++) flags.push(empties.pop());
  draw(); message(`Maze loaded. Find and collect all <b>${NUMFLAGS}</b> flags!`);
}

// Returns tile class
function tt(x,y){
  if(x===player.x&&y===player.y)return "player";
  for(let [fx,fy] of flags) if(x==fx&&y==fy) return "flag";
  return grid[y][x]==WALL?"wall":visited[y][x]?"visited":"";
}
function emojiTile(type){return EMOJIS[type]||"";}

function canEnter(nx,ny){
  if(nx<0||ny<0||nx>=SIZE||ny>=SIZE)return false;
  if(grid[ny][nx]==WALL)return false;
  return true;
}
function movePlayer(dx,dy){
  if(win)return;
  let nx=player.x+dx,ny=player.y+dy;
  if(!canEnter(nx,ny))return;
  player={x:nx,y:ny};visited[ny][nx]=true;
  let gotFlag=false;
  for(let i=0;i<flags.length;i++){
    if(nx==flags[i][0]&&ny==flags[i][1]){
      flags.splice(i,1); gotFlag=true; break;
    }
  }
  draw();
  if(gotFlag){
    if(flags.length==0){
      win=true;
      document.querySelectorAll(".tile.player").forEach(d=>{
        d.innerHTML = `<span style="font-size:1.09em;z-index:2;position:relative;">ðŸ¤–</span>`;
      });
      message("<b>ðŸš© Congrats, you found every flag!</b><br><span style='color:#fff;background:#176; padding:2px 7px;border-radius:5px;'>flag{all_ctf_flags_collected}</span>");
      setTimeout(()=>{if(confirm("Play again?"))resetMaze();},1600);
      return;
    } else {
      message(`<span style="color:#ffe;font-size:1.18em">ðŸš©</span> Flag collected! <b>${flags.length}</b> remaining.`);
    }
  } else {
    message(`${flags.length} flag${flags.length==1?"":"s"} left. Keep exploring!`);
  }
}
function draw() {
  mazeDiv.innerHTML="";
  for(let y=0;y<SIZE;y++)for(let x=0;x<SIZE;x++){
    let td=tt(x,y),d=document.createElement("div");
    d.className="tile "+td; d.tabIndex=-1;
    d.innerHTML=emojiTile(td);
    mazeDiv.appendChild(d);
  }
}
function message(txt){messageEl.innerHTML=txt;}
function focusMaze(){mazeDiv.focus();}
window.addEventListener("keydown",e=>{
  // Prevent arrows from scrolling page
  if(["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"].includes(e.key)){e.preventDefault();focusMaze();}
  if(["ArrowUp","w","W"].includes(e.key))movePlayer(0,-1);
  if(["ArrowDown","s","S"].includes(e.key))movePlayer(0,1);
  if(["ArrowLeft","a","A"].includes(e.key))movePlayer(-1,0);
  if(["ArrowRight","d","D"].includes(e.key))movePlayer(1,0);
  if(e.key==="r"||e.key==="R")resetMaze();
});
mazeDiv.addEventListener("click",focusMaze);
window.onload=() => { focusMaze(); resetMaze();}
</script>
</body>
</html>
